<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>多条件查询</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="l8it" id="多条件查询">多条件查询</h1><p data-anchor-id="cjgs"><code>项目相关</code></p><hr><p data-anchor-id="fv98">此处举一个用户列表页的多条件查询，查询条件有每页显示的条数、用户名、邮箱，你也可以增加其他查询条件。</p><p data-anchor-id="xli5">用户列表页模板部分多条件查询代码</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="rykb"><ol class="linenums"><li class="L0"><code><span class="pln">  </span><span class="tag">&lt;form</span><span class="pln"> </span><span class="atn">action</span><span class="pun">=</span><span class="atv">"{{url('admin/user')}}"</span><span class="pln"> </span><span class="atn">method</span><span class="pun">=</span><span class="atv">"get"</span><span class="tag">&gt;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="tag">&lt;table</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"search_tab"</span><span class="tag">&gt;</span></code></li><li class="L2"><code><span class="pln">        </span><span class="tag">&lt;tr&gt;</span></code></li><li class="L3"><code><span class="pln">        </span><span class="tag">&lt;th</span><span class="pln"> </span><span class="atn">style</span><span class="pun">=</span><span class="atv">"</span><span class="pln">width</span><span class="pun">:</span><span class="lit">100px</span><span class="pun">;</span><span class="atv">"</span><span class="tag">&gt;&lt;/th&gt;</span></code></li><li class="L4"><code><span class="pln">        </span><span class="tag">&lt;th&gt;</span></code></li><li class="L5"><code><span class="pln">            每页条数：</span></code></li><li class="L6"><code><span class="pln">            </span><span class="tag">&lt;select</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"num"</span><span class="tag">&gt;</span></code></li><li class="L7"><code><span class="pln">                </span><span class="tag">&lt;option</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"5"</span></code></li><li class="L8"><code><span class="pln">                  @</span><span class="atn">if</span><span class="pln">($</span><span class="atn">request</span><span class="pln">[</span><span class="atv">'num'</span><span class="pln">] </span><span class="atv">=</span><span class="pun">=</span><span class="pln"> 5)  </span><span class="atn">selected</span><span class="pln">  @</span><span class="atn">endif</span></code></li><li class="L9"><code><span class="pln">                </span><span class="tag">&gt;</span><span class="pln">5</span></code></li><li class="L0"><code><span class="pln">                </span><span class="tag">&lt;/option&gt;</span></code></li><li class="L1"><code><span class="pln">                </span><span class="tag">&lt;option</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"10"</span></code></li><li class="L2"><code><span class="pln">                  @</span><span class="atn">if</span><span class="pln">($</span><span class="atn">request</span><span class="pln">[</span><span class="atv">'num'</span><span class="pln">] </span><span class="atv">=</span><span class="pun">=</span><span class="pln"> 10)  </span><span class="atn">selected</span><span class="pln">  @</span><span class="atn">endif</span></code></li><li class="L3"><code><span class="pln">                </span><span class="tag">&gt;</span><span class="pln">10</span></code></li><li class="L4"><code><span class="pln">                </span><span class="tag">&lt;/option&gt;</span></code></li><li class="L5"><code><span class="pln">            </span><span class="tag">&lt;/select&gt;</span></code></li><li class="L6"><code><span class="pln">        </span><span class="tag">&lt;/th&gt;</span></code></li><li class="L7"><code><span class="pln">        </span><span class="tag">&lt;th</span><span class="pln"> </span><span class="atn">width</span><span class="pun">=</span><span class="atv">"70"</span><span class="tag">&gt;</span><span class="pln">用户名:</span><span class="tag">&lt;/th&gt;</span></code></li><li class="L8"><code><span class="pln">        </span><span class="tag">&lt;td&gt;&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"keywords1"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"{{$request-&gt;</span><span class="pln">keywords1}}" placeholder="用户名"&gt;</span><span class="tag">&lt;/td&gt;</span></code></li><li class="L9"><code><span class="pln">        </span><span class="tag">&lt;th</span><span class="pln"> </span><span class="atn">width</span><span class="pun">=</span><span class="atv">"70"</span><span class="tag">&gt;</span><span class="pln">邮箱:</span><span class="tag">&lt;/th&gt;</span></code></li><li class="L0"><code><span class="pln">        </span><span class="tag">&lt;td&gt;&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"keywords2"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"{{$request-&gt;</span><span class="pln">keywords2}}" placeholder="邮箱"&gt;</span><span class="tag">&lt;/td&gt;</span></code></li><li class="L1"><code><span class="pln">        </span><span class="tag">&lt;td&gt;&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"submit"</span><span class="pln">  </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"查询"</span><span class="tag">&gt;&lt;/td&gt;</span></code></li><li class="L2"><code><span class="pln">        </span><span class="tag">&lt;/tr&gt;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="tag">&lt;/table&gt;</span></code></li><li class="L4"><code><span class="tag">&lt;/form&gt;</span></code></li></ol></pre><p data-anchor-id="bqny">分页部分代码：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="s26w"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"page_list"</span><span class="tag">&gt;</span></code></li><li class="L1"><code><span class="pln">      {!! $user-&gt;appends($request-&gt;all())-&gt;render() !!}</span></code></li><li class="L2"><code><span class="tag">&lt;/div&gt;</span></code></li></ol></pre><p data-anchor-id="xq2w">后台控制器代码：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="5usu"><ol class="linenums"><li class="L0"><code><span class="pln"> $user </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">::</span><span class="pln">orderBy</span><span class="pun">(</span><span class="str">'user_id'</span><span class="pun">,</span><span class="str">'asc'</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">$query</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">use</span><span class="pun">(</span><span class="pln">$request</span><span class="pun">){</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">//检测关键字</span></code></li><li class="L3"><code><span class="pln">        $username </span><span class="pun">=</span><span class="pln"> $request</span><span class="pun">-&gt;</span><span class="pln">input</span><span class="pun">(</span><span class="str">'keywords1'</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        $email </span><span class="pun">=</span><span class="pln"> $request</span><span class="pun">-&gt;</span><span class="pln">input</span><span class="pun">(</span><span class="str">'keywords2'</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        </span><span class="com">//如果用户名不为空</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">empty</span><span class="pun">(</span><span class="pln">$username</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">            $query</span><span class="pun">-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="str">'user_name'</span><span class="pun">,</span><span class="str">'like'</span><span class="pun">,</span><span class="str">'%'</span><span class="pun">.</span><span class="pln">$username</span><span class="pun">.</span><span class="str">'%'</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//如果邮箱不为空</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">empty</span><span class="pun">(</span><span class="pln">$email</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">            $query</span><span class="pun">-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="str">'user_email'</span><span class="pun">,</span><span class="str">'like'</span><span class="pun">,</span><span class="str">'%'</span><span class="pun">.</span><span class="pln">$email</span><span class="pun">.</span><span class="str">'%'</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">})</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">-&gt;</span><span class="pln">paginate</span><span class="pun">(</span><span class="pln">$request</span><span class="pun">-&gt;</span><span class="pln">input</span><span class="pun">(</span><span class="str">'num'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">));</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'admin.user.list'</span><span class="pun">,[</span><span class="str">'user'</span><span class="pun">=&gt;</span><span class="pln">$user</span><span class="pun">,</span><span class="pln"> </span><span class="str">'request'</span><span class="pun">=&gt;</span><span class="pln"> $request</span><span class="pun">]);</span></code></li></ol></pre></div>
</body>
</html>