<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>与上传文件相关的属性方法</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="yn5t" id="与上传文件相关的属性方法">与上传文件相关的属性方法</h1><p data-anchor-id="e8lt"><code>项目相关</code></p><hr><p data-anchor-id="k9ct">客户端 <br>
form表单标签中写 empty="multipart/form-data" <br>
</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="6ibf"><ol class="linenums"><li class="L0"><code><span class="kwd">if</span><span class="pun">(</span><span class="pln">$request</span><span class="pun">-&gt;</span><span class="pln">isMethod</span><span class="pun">(</span><span class="str">'POST'</span><span class="pun">)){</span><span class="pln">	</span><span class="com">//判断是否是POST传值</span></code></li><li class="L1"><code><span class="pln">    $file </span><span class="pun">=</span><span class="pln"> $request</span><span class="pun">-&gt;</span><span class="pln">file</span><span class="pun">(</span><span class="str">'myFile'</span><span class="pun">);</span><span class="pln">    </span><span class="com">//接文件</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//文件是否上传成功</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">$file</span><span class="pun">-&gt;</span><span class="pln">isValid</span><span class="pun">()){</span><span class="pln">	</span><span class="com">//判断文件是否上传成功</span></code></li><li class="L5"><code><span class="pln">        $originalName </span><span class="pun">=</span><span class="pln"> $file</span><span class="pun">-&gt;</span><span class="pln">getClientOriginalName</span><span class="pun">();</span><span class="pln"> </span><span class="com">//源文件名</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">        $ext </span><span class="pun">=</span><span class="pln"> $file</span><span class="pun">-&gt;</span><span class="pln">getClientOriginalExtension</span><span class="pun">();</span><span class="pln">    </span><span class="com">//文件拓展名</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">        $type </span><span class="pun">=</span><span class="pln"> $file</span><span class="pun">-&gt;</span><span class="pln">getClientMimeType</span><span class="pun">();</span><span class="pln"> </span><span class="com">//文件类型</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">        $realPath </span><span class="pun">=</span><span class="pln"> $file</span><span class="pun">-&gt;</span><span class="pln">getRealPath</span><span class="pun">();</span><span class="pln">   </span><span class="com">//临时文件的绝对路径</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">        $fileName </span><span class="pun">=</span><span class="pln"> date</span><span class="pun">(</span><span class="str">'Y-m-d-H-i-s'</span><span class="pun">).</span><span class="str">'-'</span><span class="pun">.</span><span class="pln">uniqid</span><span class="pun">().</span><span class="str">'.'</span><span class="pun">.</span><span class="pln">$ext</span><span class="pun">;</span><span class="pln">  </span><span class="com">//新文件名</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">        $bool </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Storage</span><span class="pun">::</span><span class="pln">disk</span><span class="pun">(</span><span class="str">'upload'</span><span class="pun">)-&gt;</span><span class="pln">put</span><span class="pun">(</span><span class="pln">$fileName</span><span class="pun">,</span><span class="pln">file_get_contents</span><span class="pun">(</span><span class="pln">$realPath</span><span class="pun">));</span><span class="pln">   </span><span class="com">//传成功返回bool值</span></code></li><li class="L6"><code></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">        </span><span class="com">//将文件从临时目录移动到制定目录</span></code></li><li class="L9"><code><span class="pln">        $path </span><span class="pun">=</span><span class="pln"> $file</span><span class="pun">-&gt;</span><span class="pln">move</span><span class="pun">(</span><span class="pln">public_path</span><span class="pun">().</span><span class="str">'/uploads'</span><span class="pun">,</span><span class="pln">$newName</span><span class="pun">);</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">       </span><span class="com">// 将上传文件保存到七牛云上</span></code></li><li class="L2"><code><span class="pln">       </span><span class="com">// $disk = \Storage::disk('qiniu');</span></code></li><li class="L3"><code><span class="pln">       </span><span class="com">// \Storage::disk('qiniu')-&gt;writeStream('uploads/'.$newName, fopen($file-&gt;getRealPath(), 'r'));</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">       </span><span class="com">//OSS上传</span></code></li><li class="L6"><code><span class="pln">       $filepath </span><span class="pun">=</span><span class="pln"> </span><span class="str">'uploads/'</span><span class="pun">.</span><span class="pln">$newName</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">       </span><span class="com">//OSS::upload($filepath,$file-&gt;getRealPath());</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pun">}</span></code></li></ol></pre></div>
</body>
</html>