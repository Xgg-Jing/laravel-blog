<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>Laravel - Redis 缓存篇</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="ckgt" id="laravel-redis-缓存篇">Laravel - Redis 缓存篇</h1><p data-anchor-id="bbv6"><code>redis</code></p><hr><div class="md-section-divider"></div><h2 data-anchor-id="4ceh" id="一基础篇">一.基础篇</h2><blockquote data-anchor-id="y5oz" class="white-blockquote">
  <p>Redis的使用场景想必大家多多少少都了解一些了。比如新浪的首页那么多模块，那么多文章，如果读数据库是不是压力特别大，反应是不是特别慢？但是为什么新浪为什么能很快的响应页面？其中一部分功劳就是靠的Reids的缓存技术。相比较Memcached笔者还是更喜欢Redis一点。</p>
</blockquote><p data-anchor-id="vkpl">下面简单的分析一下，欢迎拍砖！</p><ul data-anchor-id="hk9x">
<li><p>Redis不仅仅支持简单的k/v类型的数据，同时还提供list，set，hash等数据结构的存储。</p></li>
<li><p>Redis支持数据的备份，即master-slave模式的数据备份。</p></li>
<li><p>Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</p></li>
</ul><p data-anchor-id="d5gq">Laravel中 使用的Redis</p><p data-anchor-id="qg9e">Redis 是一款开源且先进的键值对数据库。由于它可用的键包含了字符串、哈希、列表、集合 和 有序集合，因此常被称作数据结构服务器。在使用 Redis 之前，你必须通过 Composer 安装 predis/predis 扩展包（~1.0）。</p><p data-anchor-id="73ht">安装predis组件</p><blockquote data-anchor-id="8lm0" class="white-blockquote">
  <p>composer require "predis/predis:~1.0"  </p>
</blockquote><p data-anchor-id="ufui">配置 应用程序的 Redis 设置都在 config/database.php 配置文件中。在这个文件里，你可以看到 redis 数组里面包含了应用程序使用的 Redis 服务器：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="w79n"><ol class="linenums"><li class="L0"><code><span class="str">'redis'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="str">'cluster'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="str">'default'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L5"><code><span class="pln">        </span><span class="str">'host'</span><span class="pln">     </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'127.0.0.1'</span><span class="pun">,</span></code></li><li class="L6"><code><span class="pln">        </span><span class="str">'port'</span><span class="pln">     </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="lit">6379</span><span class="pun">,</span></code></li><li class="L7"><code><span class="pln">        </span><span class="str">'database'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">],</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pun">],</span></code></li></ol></pre><p data-anchor-id="rcjg">默认的服务器配置对于开发来说应该足够了。然而，你也可以根据使用的环境来随意更改数组。只需给每个 Redis 指定名称以及在服务器中使用的 host 和 port 即可。</p><p data-anchor-id="v1wk">基本使用方法</p><hr><p data-anchor-id="2zqt">STRING类型 - 写入字符串类型的redis</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="63xd"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'STRING:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $value </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Hello-World'</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">// 写入一个字符串类型的redis</span></code></li><li class="L3"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="typ">Set</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln">$value</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="43ew">
<li>读取相应的字符串</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="3wt8"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'STRING:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        </span><span class="com">// 读取一个字符串类型的redis</span></code></li><li class="L2"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="i1ga">和redis语法同样的 字串也有incr和decr等递增、递减...</p><hr><p data-anchor-id="ixpu">LIST类型</p><ul data-anchor-id="xrtp">
<li>写入队列</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="57py"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'LIST:TEST:R'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'PHP'</span><span class="pun">,</span><span class="str">'HTML'</span><span class="pun">,</span><span class="str">'CSS'</span><span class="pun">,</span><span class="str">'JavaScript'</span><span class="pun">,</span><span class="str">'Node'</span><span class="pun">,</span><span class="str">'Java'</span><span class="pun">,</span><span class="str">'Ruby'</span><span class="pun">,</span><span class="str">'Python'</span><span class="pun">];</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">// 从右往左压入队列</span></code></li><li class="L3"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">rpush</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln">$names</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="561a">
<li>写入队列</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="dw4v"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'LIST:TEST:R'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'PHP'</span><span class="pun">,</span><span class="str">'HTML'</span><span class="pun">,</span><span class="str">'CSS'</span><span class="pun">,</span><span class="str">'JavaScript'</span><span class="pun">,</span><span class="str">'Node'</span><span class="pun">,</span><span class="str">'Java'</span><span class="pun">,</span><span class="str">'Ruby'</span><span class="pun">,</span><span class="str">'Python'</span><span class="pun">];</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">// 获取队列内容(0到-1 所有 0到0是一位 0到1是两位)</span></code></li><li class="L3"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">lrange</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,-</span><span class="lit">1</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="2ld0">
<li>从左往右塞入队列 连贯方法</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="hkiu"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'LIST:TEST:L'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'PHP'</span><span class="pun">,</span><span class="str">'HTML'</span><span class="pun">,</span><span class="str">'CSS'</span><span class="pun">,</span><span class="str">'JavaScript'</span><span class="pun">,</span><span class="str">'Node'</span><span class="pun">,</span><span class="str">'Java'</span><span class="pun">,</span><span class="str">'Ruby'</span><span class="pun">,</span><span class="str">'Python'</span><span class="pun">];</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">// 从左往右存数据</span></code></li><li class="L3"><code><span class="pln">        \Redis</span><span class="pun">::</span><span class="pln">lpush</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln">$names</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        </span><span class="com">// 取出数据</span></code></li><li class="L5"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">lrange</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,-</span><span class="lit">1</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="78l2">HASH类型</p><ul data-anchor-id="45tg">
<li>存数据</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="xrwe"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'HASH:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'id'</span><span class="pun">=&gt;</span><span class="str">'99'</span><span class="pun">,</span></code></li><li class="L2"><code><span class="pln">                  </span><span class="str">'name'</span><span class="pun">=&gt;</span><span class="str">'AXiBa'</span><span class="pun">,</span></code></li><li class="L3"><code><span class="pln">                  </span><span class="str">'age'</span><span class="pun">=&gt;</span><span class="str">'23'</span><span class="pun">,</span></code></li><li class="L4"><code><span class="pln">                  </span><span class="str">'tel'</span><span class="pun">=&gt;</span><span class="str">'13995578699'</span><span class="pun">,</span></code></li><li class="L5"><code><span class="pln">                  </span><span class="str">'addtime'</span><span class="pun">=&gt;</span><span class="str">'1231231233'</span><span class="pun">];</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">// 将数据写入hash</span></code></li><li class="L7"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">hMset</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln">$names</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="68a7">
<li>取数据(取所有)</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="pcjr"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'HASH:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'id'</span><span class="pun">=&gt;</span><span class="str">'99'</span><span class="pun">,</span></code></li><li class="L2"><code><span class="pln">                  </span><span class="str">'name'</span><span class="pun">=&gt;</span><span class="str">'AXiBa'</span><span class="pun">,</span></code></li><li class="L3"><code><span class="pln">                  </span><span class="str">'age'</span><span class="pun">=&gt;</span><span class="str">'23'</span><span class="pun">,</span></code></li><li class="L4"><code><span class="pln">                  </span><span class="str">'tel'</span><span class="pun">=&gt;</span><span class="str">'13995578699'</span><span class="pun">,</span></code></li><li class="L5"><code><span class="pln">                  </span><span class="str">'addtime'</span><span class="pun">=&gt;</span><span class="str">'1231231233'</span><span class="pun">];</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">// 取出hash里的数据</span></code></li><li class="L7"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">hGetall</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="u2oh">
<li>取数据(取个别字段)</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="84fs"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'HASH:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'id'</span><span class="pun">=&gt;</span><span class="str">'99'</span><span class="pun">,</span></code></li><li class="L2"><code><span class="pln">                  </span><span class="str">'name'</span><span class="pun">=&gt;</span><span class="str">'AXiBa'</span><span class="pun">,</span></code></li><li class="L3"><code><span class="pln">                  </span><span class="str">'age'</span><span class="pun">=&gt;</span><span class="str">'23'</span><span class="pun">,</span></code></li><li class="L4"><code><span class="pln">                  </span><span class="str">'tel'</span><span class="pun">=&gt;</span><span class="str">'13995578699'</span><span class="pun">,</span></code></li><li class="L5"><code><span class="pln">                  </span><span class="str">'addtime'</span><span class="pun">=&gt;</span><span class="str">'1231231233'</span><span class="pun">];</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">// 取出hash里的 某一个字段的数据</span></code></li><li class="L7"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">hGet</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="str">'name'</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="f84p"><ol class="linenums"><li class="L0"><code><span class="com">// 判断这个redis key是否存在</span></code></li><li class="L1"><code><span class="pln">\Redis</span><span class="pun">::</span><span class="pln">exists</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">)；</span></code></li></ol></pre><p data-anchor-id="yra1">SET类型</p><ul data-anchor-id="imb7">
<li>写入一个无序集合(数据插入无顺序)</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ip1i"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SET:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $value </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">,</span><span class="str">'e'</span><span class="pun">];</span></code></li><li class="L2"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">sadd</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln">$value</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">         $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">smembers</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="l3a0">
<li>求两个集合的交集</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="hxck"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SET:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $key1 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SET:TEST:1'</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">        $value </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">,</span><span class="str">'e'</span><span class="pun">];</span></code></li><li class="L3"><code><span class="pln">        $value1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'1'</span><span class="pun">,</span><span class="str">'2'</span><span class="pun">];</span></code></li><li class="L4"><code><span class="pln">        </span><span class="com">// 写入另一个集合</span></code></li><li class="L5"><code><span class="pln">        \Redis</span><span class="pun">::</span><span class="pln">sadd</span><span class="pun">(</span><span class="pln">$key1</span><span class="pun">,</span><span class="pln">$value1</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">// 交集</span></code></li><li class="L7"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">sinter</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln">$key1</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="govx">
<li>求两个集合的并集</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ycw7"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SET:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $key1 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SET:TEST:1'</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">        $value </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">,</span><span class="str">'e'</span><span class="pun">];</span></code></li><li class="L3"><code><span class="pln">        $value1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'1'</span><span class="pun">,</span><span class="str">'2'</span><span class="pun">];</span></code></li><li class="L4"><code><span class="pln">        </span><span class="com">// 并集</span></code></li><li class="L5"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">sunion</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln">$key1</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="3z6e">
<li>求两个集合的差集</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="fwhx"><ol class="linenums"><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhotoController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span><span class="pln">  </span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L4"><code><span class="com">     *</span></code></li><li class="L5"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L6"><code><span class="com">     */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L0"><code><span class="pln">        $key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SET:TEST'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $key1 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SET:TEST:1'</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">        $value </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">,</span><span class="str">'e'</span><span class="pun">];</span></code></li><li class="L3"><code><span class="pln">        $value1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'1'</span><span class="pun">,</span><span class="str">'2'</span><span class="pun">];</span></code></li><li class="L4"><code><span class="pln">        </span><span class="com">// 差集</span></code></li><li class="L5"><code><span class="pln">        $info </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">sdiff</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln">$key1</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$info</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> view</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="hns9">哪个key在前，就以哪个key的值为基准。。</p><div class="md-section-divider"></div><h2 data-anchor-id="wusc" id="二predis-基本数据隔离">二.Predis -基本数据隔离</h2><p data-anchor-id="485a">队列如何配合STRING类型或者HASH类型来组合使用，甚至把非关系变成和MySQl一样成为关系型的。</p><div class="md-section-divider"></div><h3 data-anchor-id="7n18" id="队列与哈希的组合使用-实现数据关系化">队列与哈希的组合使用 - 实现数据关系化</h3><blockquote data-anchor-id="qwxi" class="white-blockquote">
  <p>思路 :利用队列里的值来做需要取数据的唯一索引，利用哈希的key的后缀名做原型数据的唯一索引</p>
</blockquote><p data-anchor-id="0aye">队列和哈希的组合使用优势是，取出来可以直接使用，劣势在于内存占用相比较字符串而言要大</p><ul data-anchor-id="is1g">
<li>实例:因为Redis只能存数组而我们实例为了方便直接用DB类来写的，如果是ORM可以直接返回数组的</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="3cgd"><ol class="linenums"><li class="L0"><code><span class="com">/**</span></code></li><li class="L1"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L2"><code><span class="com">     *</span></code></li><li class="L3"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L4"><code><span class="com">     */</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L8"><code><span class="pln">        $where </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'status'</span><span class="pun">=&gt;</span><span class="str">'1'</span><span class="pun">];</span></code></li><li class="L9"><code><span class="pln">        $obj </span><span class="pun">=</span><span class="pln"> \DB</span><span class="pun">::</span><span class="pln">table</span><span class="pun">(</span><span class="str">'data_admin_login'</span><span class="pun">)-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="pln">$where</span><span class="pun">)-&gt;</span><span class="kwd">get</span><span class="pun">();</span></code></li><li class="L0"><code><span class="pln">        $array </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">objectToArray</span><span class="pun">(</span><span class="pln">$obj</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$array</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="tjln">
<li>接下来 我们要把从数据库取出来的数据存入Redis，用什么样的方法存，用什么样的方法取，这些东西都得考虑好；下面实例如下：</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="5l0y"><ol class="linenums"><li class="L0"><code><span class="com">/**</span></code></li><li class="L1"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L2"><code><span class="com">     *</span></code></li><li class="L3"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L4"><code><span class="com">     */</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L8"><code><span class="pln">        $where </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'status'</span><span class="pun">=&gt;</span><span class="str">'1'</span><span class="pun">];</span></code></li><li class="L9"><code><span class="pln">        $obj </span><span class="pun">=</span><span class="pln"> \DB</span><span class="pun">::</span><span class="pln">table</span><span class="pun">(</span><span class="str">'data_admin_login'</span><span class="pun">)-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="pln">$where</span><span class="pun">)-&gt;</span><span class="kwd">get</span><span class="pun">();</span></code></li><li class="L0"><code><span class="pln">        $array </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">objectToArray</span><span class="pun">(</span><span class="pln">$obj</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">        </span><span class="com">// 定义Redis的key</span></code></li><li class="L2"><code><span class="pln">        $listKey </span><span class="pun">=</span><span class="pln"> </span><span class="str">'LIST:TEST:ADMIN'</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">        $hashKey </span><span class="pun">=</span><span class="pln"> </span><span class="str">'HASH:TEST:ADMIN:'</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">        </span><span class="com">// 遍历时写入Redis list为索引 hash为数据</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$array </span><span class="kwd">as</span><span class="pln"> $v</span><span class="pun">){</span></code></li><li class="L6"><code><span class="pln">            \Redis</span><span class="pun">::</span><span class="pln">rpush</span><span class="pun">(</span><span class="pln">$listKey</span><span class="pun">,</span><span class="pln">$v</span><span class="pun">[</span><span class="str">'guid'</span><span class="pun">]);</span></code></li><li class="L7"><code><span class="pln">            \Redis</span><span class="pun">::</span><span class="pln">hMset</span><span class="pun">(</span><span class="pln">$hashKey</span><span class="pun">.</span><span class="pln">$v</span><span class="pun">[</span><span class="str">'guid'</span><span class="pun">],</span><span class="pln">$v</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'缓存写入成功'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre><ul data-anchor-id="uy85">
<li>查看下redis里面的情况 第一个 查看所有key 发现有1个队列和16个哈希 <br>
第二个 取LIST:TEST:ADMIN 整个队列 发现有16个 唯一识别ID的数据（而且顺序和从数据库取出来的顺序是一样的）</li>
</ul><p data-anchor-id="zd5u">第三个取出其中一个哈希查看数据</p><ul data-anchor-id="h9t1">
<li>可以看出来 我们想要的数据已经存入了redis中，接下来，如果我想通过redis直接获取MySQL中管理员的列表数据怎么使用呢?</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="iyvo"><ol class="linenums"><li class="L0"><code><span class="com">/**</span></code></li><li class="L1"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L2"><code><span class="com">     *</span></code></li><li class="L3"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L4"><code><span class="com">     */</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L8"><code><span class="pln">        </span><span class="com">// 定义Redis的key</span></code></li><li class="L9"><code><span class="pln">        $listKey </span><span class="pun">=</span><span class="pln"> </span><span class="str">'LIST:TEST:ADMIN'</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">        $hashKey </span><span class="pun">=</span><span class="pln"> </span><span class="str">'HASH:TEST:ADMIN:'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        </span><span class="com">// 取出admin队列的唯一识别id数组</span></code></li><li class="L2"><code><span class="pln">        $list </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">lrange</span><span class="pun">(</span><span class="pln">$listKey</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,-</span><span class="lit">1</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">        $array </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$list </span><span class="kwd">as</span><span class="pln"> $v</span><span class="pun">){</span></code></li><li class="L5"><code><span class="pln">            </span><span class="com">// 取出哈希里的数据写入大数组中</span></code></li><li class="L6"><code><span class="pln">            $array</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">hGetall</span><span class="pun">(</span><span class="pln">$hashKey</span><span class="pun">.</span><span class="pln">$v</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">        dd</span><span class="pun">(</span><span class="pln">$array</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="fktm">这样取出来的数据是不是一样可以遍历到模版上？</p><ul data-anchor-id="12pc">
<li>最后来完整的做一个例子 <br>


<blockquote class="white-blockquote">
  思路：我们的目的是从redis里面取出想要输出到模版上的数据，但是redis大家也知道，只是缓存服务器重启了，就没了（除非做磁盘持久化）,但是我要做的是如果Redis里面没有我要从MySQL里面取，取到了然后写入Redis，保证对MySQL的请求大大减少。</blockquote></li>
  </ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="7od5"><ol class="linenums"><li class="L0"><code><span class="com">/**</span></code></li><li class="L1"><code><span class="com">     * Display a listing of the resource.</span></code></li><li class="L2"><code><span class="com">     *</span></code></li><li class="L3"><code><span class="com">     * @return \Illuminate\Http\Response</span></code></li><li class="L4"><code><span class="com">     */</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> index</span><span class="pun">()</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="com">//</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">        </span><span class="com">// 定义Redis的key</span></code></li><li class="L0"><code><span class="pln">        $listKey </span><span class="pun">=</span><span class="pln"> </span><span class="str">'LIST:TEST:ADMIN'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        $hashKey </span><span class="pun">=</span><span class="pln"> </span><span class="str">'HASH:TEST:ADMIN:'</span><span class="pun">;</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">        </span><span class="com">// 查看key是否存在？</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">empty</span><span class="pun">(</span><span class="pln">\Redis</span><span class="pun">::</span><span class="pln">exists</span><span class="pun">(</span><span class="pln">$listKey</span><span class="pun">))){</span></code></li><li class="L5"><code><span class="pln">            </span><span class="com">// 如果Redis不存在 读数据库然后写入redis</span></code></li><li class="L6"><code><span class="pln">            $where </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'status'</span><span class="pun">=&gt;</span><span class="str">'1'</span><span class="pun">];</span></code></li><li class="L7"><code><span class="pln">            $obj </span><span class="pun">=</span><span class="pln"> \DB</span><span class="pun">::</span><span class="pln">table</span><span class="pun">(</span><span class="str">'data_admin_login'</span><span class="pun">)-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="pln">$where</span><span class="pun">)-&gt;</span><span class="kwd">get</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">            $array </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">objectToArray</span><span class="pun">(</span><span class="pln">$obj</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">            </span><span class="com">// 遍历时写入Redis list为索引 hash为数据</span></code></li><li class="L0"><code><span class="pln">            </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$array </span><span class="kwd">as</span><span class="pln"> $v</span><span class="pun">){</span></code></li><li class="L1"><code><span class="pln">                \Redis</span><span class="pun">::</span><span class="pln">rpush</span><span class="pun">(</span><span class="pln">$listKey</span><span class="pun">,</span><span class="pln">$v</span><span class="pun">[</span><span class="str">'guid'</span><span class="pun">]);</span></code></li><li class="L2"><code><span class="pln">                \Redis</span><span class="pun">::</span><span class="pln">hMset</span><span class="pun">(</span><span class="pln">$hashKey</span><span class="pun">.</span><span class="pln">$v</span><span class="pun">[</span><span class="str">'guid'</span><span class="pun">],</span><span class="pln">$v</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L4"><code><span class="pln">            </span><span class="kwd">return</span><span class="pln"> $array</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">// 如果redis存在 直接读redis的数据</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">        </span><span class="com">// 取出admin队列的唯一识别id数组</span></code></li><li class="L9"><code><span class="pln">        $list </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">lrange</span><span class="pun">(</span><span class="pln">$listKey</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,-</span><span class="lit">1</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">        $array </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$list </span><span class="kwd">as</span><span class="pln"> $v</span><span class="pun">){</span></code></li><li class="L2"><code><span class="pln">            $array</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> \Redis</span><span class="pun">::</span><span class="pln">hGetall</span><span class="pun">(</span><span class="pln">$hashKey</span><span class="pun">.</span><span class="pln">$v</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $array</span><span class="pun">;</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">    </span><span class="str">```</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="str">    * 不管我把redis的key手动删除还是redis的key存在 我们输出的都是这个(这是我的浏览器插件json-handle的效果)</span></code></li><li class="L0"><code><span class="str">    * 删除redis的key 效果依旧</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="str">那么肯定有人又要问了 你这只是在读数据库 如果我增 删 改 后 redis不同步了哇</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="str">是这样的，所以一般我们在实际商业项目中 做一个大型的redis数据隔离都需要把mysql的增删改 绑上同步的redis操作，这样下来，我每次读redis既大大的提升了性能，也保障了数据的同步性</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="str">下面拿添加做一个实例，如何MySQL与redis数据同步</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="str">restfulApi 添加方法</span></code></li></ol></pre><pre data-anchor-id="24i3"><code>    $data = [
            'guid'=&gt; '12341234123412341234123412341234',
            'email'=&gt; 'adminadmin@163.com',
            'password'=&gt; '111dcfeb6d42b320d9b885f1b8fa498a',
            'status'=&gt; '1',
            'sroce'=&gt; '0',
            'addtime'=&gt; time(),
            'logintime'=&gt; '',
            'ip'=&gt; ''
        ];
        $temp = \DB::table('data_admin_login')-&gt;insert($data);
        if($temp){
        \Redis::rpush($listKey,$data['guid']);
        \Redis::hMset($hashKey.$data['guid'],$data);

        return '写入成功';
    }
        return '写入失败';
}
</code></pre><ul data-anchor-id="xhy4">
<li>redis查看一下有没有同步写入 <br>
我们发现数据同步进入了redis</li>
<li>index方法代码不变 再请求一次 数据也明显同步了</li>
</ul><blockquote data-anchor-id="2i82" class="white-blockquote">
  <p>以上讲的就是最基本的redis隔离技术，当然为了提现的简单点，直接都写在控制器里面了，并没有做过多的分层调用，RedisKey也没有做配置话，而是反复在用；实际项目中Redis是可以单独做一个模块的，架构的层级分化明确了也可以大大的提升Redis的复用性;当然这些只是建议和思路，主要还是看当前每个人手头的架构为主。</p>
</blockquote><p data-anchor-id="tphi">其他组合关系型方法</p><p data-anchor-id="5ood">至于其他的关系型的组合方法就在下面简要做做介绍了,纯手码写得也挺累，望大家体谅。。</p><ul data-anchor-id="0s3z">
<li>队列和字符串类型 <br>
队列和字符串类型一样可以把数据关系型</li>
</ul><blockquote data-anchor-id="iyag" class="white-blockquote">
  <p>思路：同样的list存索引的key(ID或唯一识别ID),字符串存json字符串,字符串的key同样后缀加唯一识别ID来进行区分。当需要输出到页面上的时候json_decode过来就行了</p>
</blockquote><p data-anchor-id="vxn1">队列和字符串的优点是存储的空间小，劣势在于存的时候要解析成字符串，取的时候要解析为数组或对象</p><ul data-anchor-id="enlm">
<li>集合和字符串类型 <br>
集合和字符串类型一样可以把数据关系型</li>
</ul><blockquote data-anchor-id="8k52" class="white-blockquote">
  <p>思路：大家应该都知道 redis集合有有序集合和无序集合之分，在有些场景中，其实用集合的形式反而更灵活（多维度集合控制），比如 关注我的人、我关注的人、同时互相关注的、QQ中的'可能认识的人'、异步写入时分区间等等等...</p>
</blockquote><ul data-anchor-id="rkdq">
<li>集合和哈希类型 <br>
思路其实就是和上面差不多，也就是存储方便，消耗内存相比较而言较大。</li>
</ul><blockquote data-anchor-id="j6al" class="white-blockquote">
  <p>参考 redis中文官网 <a href="http://www.redis.cn/" target="_blank">http://www.redis.cn/</a> <br>
  参考 易百教程 <a href="http://www.yiibai.com/redis/redis_environment.html" target="_blank">http://www.yiibai.com/redis/redis_environment.html</a></p>
</blockquote></div>
</body>
</html>