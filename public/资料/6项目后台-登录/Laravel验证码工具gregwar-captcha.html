<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>Laravel验证码工具gregwar/captcha</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="n1oe" id="laravel验证码工具gregwarcaptcha">Laravel验证码工具gregwar/captcha</h1><p data-anchor-id="gbky"><code>项目相关</code></p><hr><blockquote data-anchor-id="kn3e" class="white-blockquote">
  <p>Ps:gregwar/captcha在Composer下载排行中长居第一名榜位。好用的工具大家都推荐，这个验证码工具作者本人也在很多项目中运用到了。给大家推荐的同时分享点经验。</p>
</blockquote><p data-anchor-id="fcuh"><img src="http://on64ewxzt.bkt.clouddn.com/blog/20170907/132913004.png" alt="mark" title=""></p><div class="md-section-divider"></div><h2 data-anchor-id="nvxr" id="一安装方法">一、安装方法</h2><p data-anchor-id="uppn">1.在项目根目录下执行:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="umkf"><ol class="linenums"><li class="L0"><code><span class="pln">composer </span><span class="kwd">require</span><span class="pln"> gregwar</span><span class="pun">/</span><span class="pln">captcha</span></code></li></ol></pre><p data-anchor-id="l5q6">2.在composer.json中添加:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="wtki"><ol class="linenums"><li class="L0"><code><span class="pln">  </span><span class="str">"require"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">...</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">...</span></code></li><li class="L3"><code><span class="pln">    </span><span class="str">"gregwar/captcha"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1.*"</span></code></li><li class="L4"><code><span class="pun">},</span></code></li></ol></pre><p data-anchor-id="o7hp">然后执行 <code>composer update</code></p><p data-anchor-id="uyjr">这样安装就算完成了。</p><div class="md-section-divider"></div><h2 data-anchor-id="jl4t" id="二使用方法">二、使用方法</h2><p data-anchor-id="iwid">1.命名空间引入</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="a7yx"><ol class="linenums"><li class="L0"><code><span class="kwd">use</span><span class="pln"> </span><span class="typ">Gregwar</span><span class="pln">\Captcha\CaptchaBuilder</span><span class="pun">;</span><span class="pln"> </span></code></li><li class="L1"><code><span class="kwd">use</span><span class="pln"> </span><span class="typ">Gregwar</span><span class="pln">\Captcha\PhraseBuilder</span><span class="pun">;</span></code></li></ol></pre><p data-anchor-id="axq8">下面给大家一个完整的例子</p><p data-anchor-id="yzb7">路由定义(注意:该路由放在中间件外)</p><p data-anchor-id="z4uv"><code>Route::get('/code/captcha/{tmp}', 'Admin\LoginController@captcha');</code></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="qx73"><ol class="linenums"><li class="L0"><code><span class="com">// 验证码生成</span></code></li><li class="L1"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> captcha</span><span class="pun">(</span><span class="pln">$tmp</span><span class="pun">)</span></code></li><li class="L2"><code><span class="pun">{</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    $phrase </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PhraseBuilder</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">    </span><span class="com">// 设置验证码位数</span></code></li><li class="L6"><code><span class="pln">    $code </span><span class="pun">=</span><span class="pln"> $phrase</span><span class="pun">-&gt;</span><span class="pln">build</span><span class="pun">(</span><span class="lit">6</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">    </span><span class="com">// 生成验证码图片的Builder对象，配置相应属性</span></code></li><li class="L8"><code><span class="pln">    $builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CaptchaBuilder</span><span class="pun">(</span><span class="pln">$code</span><span class="pun">,</span><span class="pln"> $phrase</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com">// 设置背景颜色</span></code></li><li class="L0"><code><span class="pln">    $builder</span><span class="pun">-&gt;</span><span class="pln">setBackgroundColor</span><span class="pun">(</span><span class="lit">220</span><span class="pun">,</span><span class="pln"> </span><span class="lit">210</span><span class="pun">,</span><span class="pln"> </span><span class="lit">230</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">    $builder</span><span class="pun">-&gt;</span><span class="pln">setMaxAngle</span><span class="pun">(</span><span class="lit">25</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    $builder</span><span class="pun">-&gt;</span><span class="pln">setMaxBehindLines</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">    $builder</span><span class="pun">-&gt;</span><span class="pln">setMaxFrontLines</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="com">// 可以设置图片宽高及字体</span></code></li><li class="L5"><code><span class="pln">    $builder</span><span class="pun">-&gt;</span><span class="pln">build</span><span class="pun">(</span><span class="pln">$width </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">,</span><span class="pln"> $height </span><span class="pun">=</span><span class="pln"> </span><span class="lit">40</span><span class="pun">,</span><span class="pln"> $font </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    </span><span class="com">// 获取验证码的内容</span></code></li><li class="L7"><code><span class="pln">    $phrase </span><span class="pun">=</span><span class="pln"> $builder</span><span class="pun">-&gt;</span><span class="pln">getPhrase</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">    </span><span class="com">// 把内容存入session</span></code></li><li class="L9"><code><span class="pln">    \Session</span><span class="pun">::</span><span class="pln">flash</span><span class="pun">(</span><span class="str">'code'</span><span class="pun">,</span><span class="pln"> $phrase</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">// 生成图片</span></code></li><li class="L1"><code><span class="pln">    header</span><span class="pun">(</span><span class="str">"Cache-Control: no-cache, must-revalidate"</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    header</span><span class="pun">(</span><span class="str">"Content-Type:image/jpeg"</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">    $builder</span><span class="pun">-&gt;</span><span class="pln">output</span><span class="pun">();</span></code></li><li class="L4"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="cikc">模版案例</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="psxh"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"captcha"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">placeholder</span><span class="pun">=</span><span class="atv">"验证码"</span><span class="tag">&gt;</span><span class="pln">  </span></code></li><li class="L1"><code><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">javascript</span><span class="pun">:</span><span class="pln">re_captcha</span><span class="pun">();</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">  </span></code></li><li class="L2"><code><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ URL('/code/captcha/1') }}"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"127ddf0de5a04167a9e427d883690ff6"</span><span class="tag">&gt;</span><span class="pln">  </span></code></li><li class="L3"><code><span class="tag">&lt;/a&gt;</span><span class="pln">  </span></code></li></ol></pre><p data-anchor-id="d1mm">Js点击换验证码</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="i64n"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="tag">&gt;</span><span class="pln">  </span></code></li><li class="L1"><code><span class="kwd">function</span><span class="pln"> re_captcha</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span></code></li><li class="L2"><code><span class="pln">    $url </span><span class="pun">=</span><span class="pln"> </span><span class="str">"{{ URL('/code/captcha') }}"</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">    $url </span><span class="pun">=</span><span class="pln"> $url </span><span class="pun">+</span><span class="pln"> </span><span class="str">"/"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">random</span><span class="pun">();</span></code></li><li class="L4"><code><span class="pln">        document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">'127ddf0de5a04167a9e427d883690ff6'</span><span class="pun">).</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> $url</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code><span class="tag">&lt;/script&gt;</span><span class="pln"> </span></code></li></ol></pre><p data-anchor-id="hu5l">如何验证(由于是案例 我只做最基础的验证)</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="uqiu"><ol class="linenums"><li class="L0"><code><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> store</span><span class="pun">(</span><span class="typ">Request</span><span class="pln"> $request</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//</span></code></li><li class="L4"><code><span class="pln">    $data </span><span class="pun">=</span><span class="pln"> \Input</span><span class="pun">::</span><span class="pln">all</span><span class="pun">();</span></code></li><li class="L5"><code><span class="pln">    </span><span class="com">//验证码验证</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$data</span><span class="pun">[</span><span class="str">'captcha'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> \Session</span><span class="pun">::</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'code'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> back</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">            </span><span class="pun">-&gt;</span><span class="pln">withErrors</span><span class="pun">(</span><span class="str">'验证码错误!'</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre></div>
</body>
</html>